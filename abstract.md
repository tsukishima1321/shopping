**在线购物系统数据库设计(MSSQLServer)**

- 实体信息：
    - 一般用户（User）：用户ID、用户名、密码、注册时间、最后登录时间、是否为商家
    - 商家用户（Seller）：用户ID、手机号、证件号、真实姓名
    - 商家用户申请（SellerApply）：用户ID、手机号、证件号、真实姓名、申请时间、审核状态
    - 地址（Address）：地址ID、用户ID、地址、收货人、联系电话、是否默认地址
    - 店铺（Shop）：店铺ID、所属商家ID、店铺名称、店铺描述、店铺状态
    - 商品（Goods）：商品ID、所属店铺ID、商品名称、商品描述、商品价格、商品状态、商品图片
    - 订单（Order）：订单ID、用户ID、订单状态、订单总价、订单创建时间、订单涉及的店铺
    - 订单中的商品（OrderGoods）：订单ID、商品ID、商品数量
    - 用户购物车中的商品（CartGoods）：用户ID、商品ID、商品数量
    - 评论（Comment）：评论ID、商品ID、用户ID、评论内容、评论时间
    - 收藏（Collect）：收藏ID、商品ID、用户ID、收藏时间
    - 管理员（Admin）：管理员ID、管理员名称、密码
    - 用户权限（UserPermission）：用户ID、是否允许登录、是否允许购物、是否允许评论、是否允许添加店铺、是否允许添加商品、是否允许处理订单

- 联系信息：
    - 一般用户与地址：一对多
    - 商家用户为特殊的一般用户，在一般用户的基础上增加了商家信息。
    - 商家用户与店铺：一对多
    - 店铺与商品：一对多
    - 一般用户与订单：一对多
    - 订单与订单中的商品：一对多
    - 用户与用户购物车中的商品：一对多
    - 一般用户与评论：一对多
    - 一般用户与收藏：一对多
    - 用户与用户权限：一对一

- 目标行为：
    - 一般用户：
        - 注册
        - 登录
        - 查看和修改个人信息
        - 查看、添加、删除和修改地址，设置默认地址
        - 查看个人订单内容和状态
        - 查看个人购物车，删除购物车中的商品，修改购物车中的商品数量
        - 将购物车提交为订单
        - 搜索店铺，查看店铺信息和店铺中的商品
        - 搜索商品，查看商品信息和评论
        - 将商品加入收藏
        - 将商品加入购物车
        - 为商品添加评论
        - 认证成为商家

    - 商家用户：
        - 添加、修改和删除店铺
        - 查看个人店铺，查看店铺中的商品
        - 在店铺中添加、删除和修改商品
        - 接收和处理订单

    - 管理员：
        - 审核商家认证
        - 查看用户信息
        - 查看店铺信息
        - 调整用户权限，封禁用户

- 行为具体流程：
行为 | 数据库操作
--- | ---
用户注册：用户输入用户名、密码。系统生成用户ID和注册时间，在用户权限表中添加一条记录，设置默认权限。 | INSERT Users, INSERT UserPermission 
用户登录：用户输入用户名、密码。系统验证用户名和密码，返回登录成功或失败，更新用户登录时间。 | SELECT Users 
查看和修改个人信息：用户查看个人信息，可以修改用户名、密码。 | SELECT User，UPDATE Users 
查看、添加、删除和修改地址，设置默认地址：用户查看个人地址，可以添加、删除和修改地址，可以设置默认地址。 | SELECT Address，INSERT Address，DELETE Address，UPDATE Address 
查看个人订单：用户查看个人订单，可以查看订单详情。 | SELECT Orders 
查看个人购物车，删除购物车中的商品，修改购物车中的商品数量：用户查看个人购物车，可以删除购物车中的商品，可以修改购物车中的商品数量。 | SELECT CartGoods，DELETE CartGoods，UPDATE CartGoods 
将购物车提交为订单：用户将购物车中的商品提交为订单，系统生成订单ID和订单创建时间，计算订单总价。 | INSERT Order，DELETE CartGoods，INSERT OrderGoods
搜索店铺，查看店铺信息和店铺中的商品：用户搜索店铺，查看店铺信息和店铺中的商品。 | SELECT Shop，SELECT Goods
搜索商品，查看商品信息和评论：用户搜索商品，查看商品信息和评论。 | SELECT Goods，SELECT Comment
将商品加入收藏：用户将商品加入收藏。 | INSERT Collect
将商品加入购物车：用户将商品加入购物车。 | INSERT CartGoods
为商品添加评论：用户为商品添加评论，系统生成评论ID和评论时间。 | INSERT Comment
认证成为商家：用户申请认证成为商家，系统生成商家用户ID，更新用户权限。 | INSERT Seller，UPDATE UserPermission
添加、修改和删除店铺：商家用户添加、修改和删除店铺。 | INSERT Shop，UPDATE Shop，DELETE Shop
查看个人店铺，查看店铺中的商品：商家用户查看个人店铺，查看店铺中的商品。 | SELECT Shop，SELECT Goods
在店铺中添加、删除和修改商品：商家用户在店铺中添加、删除和修改商品。 | INSERT Goods，DELETE Goods，UPDATE Goods
接收和处理订单：商家用户接收和处理订单。 | SELECT Order，UPDATE Orders
查看用户信息：管理员查看用户信息。 | SELECT Users
查看店铺信息：管理员查看店铺信息。 | SELECT Shop
调整用户权限，封禁用户：管理员调整用户权限，封禁用户。 | UPDATE UserPermission

- SQL建立表格：
    - 参见：sql/CreateTable.sql

- 视图设计：
    - 参见：sql/CreateTable.sql

- 触发器设计（MS SQLServer）：
    - 参见：sql/CreateTrigger.sql

- 储存过程设计（MS SQLServer）：
    - 参见：sql/CreateProc.sql

- 为数据库插入测试数据： 
    - 参见：sql/testInsert.sql

- 初步测试语句
    - 参见：sql/test.sql

- 客户端窗体设计：
    - 登录窗体
        - 选择是否为管理员
        - 输入用户名、密码
        - 登录按钮
        - 注册按钮
        - 提示登录成功或失败
        - 若登录成功，关闭登录窗体，打开用户主窗体或管理员主窗体（记录数据库返回的用户ID）
    - 注册窗体
        - 输入用户名、密码
        - 注册按钮
        - 提示注册成功或失败
        - 若注册成功，关闭注册窗体，回到登录窗体
    - 用户主窗体
        - 打开搜索窗体按钮
        - 显示用户基本信息
        - 打开用户信息和地址窗体按钮
        - 打开用户订单窗体按钮
        - 打开用户购物车窗体按钮
        - 打开用户收藏窗体按钮
        - 注册成为商家按钮
    - 用户信息和地址窗体
        - 显示用户信息
        - 修改用户名、密码按钮
        - 显示用户地址
        - 添加地址按钮
        - 删除地址按钮
        - 修改地址按钮
        - 设置默认地址按钮
    - 用户收藏窗体
        - 显示用户收藏的商品
        - 删除收藏按钮
    - 注册成为商家窗体
        - 输入手机号、证件号、真实姓名
        - 提交按钮
        - 提示提交成功或失败
        - 若提交成功，关闭窗体
    - 用户订单窗体
        - 显示用户订单和状态
        - 订单下拉显示订单包含的商品
    - 用户购物车窗体
        - 打开订单提交窗体按钮
        - 显示购物车中的商品
        - 删除商品按钮
        - 修改商品数量按钮
    - 订单提交窗体
        - 显示订单总价
        - 选择地址
        - 提交订单按钮
    - 搜索窗体
        - 输入搜索关键字
        - 搜索条件：排序方式、过滤器等
        - 搜索按钮
        - 显示搜索结果
        - 点击商品显示商品详情窗体
    - 店铺详情窗体
        - 显示店铺信息
        - 显示店铺中的商品
        - 点击商品显示商品详情窗体
    - 商品详情窗体
        - 显示商品信息
        - 显示商品评论
        - 添加评论按钮
        - 加入购物车按钮
        - 加入收藏按钮
    - 商家主窗体
        - 显示商家信息
        - 显示商家店铺
        - 添加店铺按钮
        - 删除店铺按钮
        - 点击店铺显示店铺管理窗体
        - 打开订单处理窗体按钮
    - 订单处理窗体
        - 显示订单信息
        - 修改订单状态按钮
    - 店铺管理窗体
        - 显示店铺信息
        - 显示店铺中的商品
        - 添加商品按钮
        - 删除商品按钮
        - 点击商品显示商品管理
    - 商品管理窗体
        - 显示商品信息
        - 修改商品信息按钮
        - 删除商品按钮
    - 管理员主窗体
        - 浏览商家申请列表
        - 处理商家申请
        - 浏览用户列表
        - 点击用户显示用户权限管理窗体
    - 用户权限管理窗体
        - 显示用户权限
        - 修改用户权限按钮
        - 封禁用户按钮



